# ETL
抽取组件过滤条件的组合模式设计
1. 设计背景
在数据抽取环节，往往需要根据不同的业务需求灵活拼接各类过滤条件（如AND/OR组合、表达式条件、多值/单值等）。为提升表达能力与扩展性，采用组合模式实现过滤条件的灵活组装，将原有的条件树结构转化为有序递归拼接、顺序输出每个条件的模型设计。

2. 关键模型设计
2.1 抽象基类 FilterConditionModel
核心属性

order：执行顺序

subConditions：子条件集合（And/Or组合用）

核心方法

toConditionStr()：抽象方法，递归拼接当前节点及其子条件为完整的过滤条件字符串

2.2 表达式条件模型 ExpressionFilterConditionModel
核心属性

field：字段名

fieldType：字段类型

operator：比较符（如=, >, <, in等）

isRequire：是否为必需条件

valueType：值类型（如字符串、数值等）

value：具体值

能力描述

直接根据各参数拼接单值或多值（IN）表达式过滤条件字符串

可用于叶子节点的表达式拼接

2.3 逻辑条件模型 LogicalFilterConditionModel
核心属性

logicalType：逻辑类型（AND / OR）

subConditions：FilterConditionModel子条件集合

能力描述

递归调用子条件的toConditionStr()，按照指定执行顺序组合输出

支持任意深度、复杂度的嵌套逻辑过滤

3. 类结构图建议
你可以绘制如下UML类图：

pgsql
复制
编辑
                +-------------------------+
                |  FilterConditionModel   |<-------------------------------+
                +-------------------------+                                |
                | - order: int            |                                |
                | - subConditions: List<> |                                |
                +-------------------------+                                |
                | + toConditionStr():str  |                                |
                +-------------------------+                                |
                        ^                                                 |
           +------------+------------+                          +----------+--------------------+
           |                         |                          |                               |
+---------------------------+    +----------------------------+    +-----------------------------+
|ExpressionFilterCondition  |    | LogicalFilterCondition     |    |   （可扩展更多子类）         |
+---------------------------+    +----------------------------+    +-----------------------------+
| - field                   |    | - logicalType (AND/OR)     |    |                             |
| - fieldType               |    | - subConditions            |    |                             |
| - operator                |    +----------------------------+    |                             |
| - isRequire               |    | + toConditionStr()         |    |                             |
| - valueType               |    +----------------------------+    |                             |
| - value                   |                                     |                             |
+---------------------------+                                     +-----------------------------+
| + toConditionStr()        |
+---------------------------+
4. 工作机制与执行流程
所有过滤条件模型均实现toConditionStr()方法：

ExpressionFilterConditionModel直接拼接字段条件表达式

LogicalFilterConditionModel递归拼接所有子条件，支持多层嵌套和灵活组合

通过对子条件的order字段排序，保证输出的条件字符串有严格的执行顺序，从而将原有条件树结构转化为线性、递归输出的格式，简化理解和调试

5. 设计优势分析
组合模式：易于表达任意复杂的条件组合，支持灵活扩展新类型过滤条件

递归拼接+顺序输出：比传统条件树结构更清晰，逻辑更易跟踪和维护

本设计将条件的表示（ExpressionFilterConditionModel）与条件的组合逻辑（LogicalFilterConditionModel）清晰分离：

- 表示层 ：关注单个条件如何表达和转换
- 逻辑层 ：关注条件之间如何组合
这种分离使得代码更加清晰，职责单一，易于维护。
 3.2.2 依赖倒置原则的应用
所有具体条件类都依赖于抽象的FilterConditionModel，而不是相互依赖，这符合依赖倒置原则：

- LogicalFilterConditionModel依赖于抽象的FilterConditionModel接口
- 高层模块不依赖于低层模块的具体实现
### 3.3 性能优化 3.3.1 执行顺序优化
通过 order 属性控制条件的执行顺序，实现了两个关键优化：

1. 条件评估顺序优化 ：可以将计算成本低的条件放在前面先执行，提前过滤掉不符合条件的数据
2. 递归转迭代 ：通过排序，将原本需要递归遍历的条件树转换为顺序执行的形式，避免了深层递归可能带来的栈溢出风险

单一接口：统一使用toConditionStr()拼接输出，极大提高扩展性和解耦性

顺序控制：通过order属性灵活控制过滤条件输出顺序，满足更复杂业务需求

